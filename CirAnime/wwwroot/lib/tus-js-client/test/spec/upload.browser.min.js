/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/tus-js-client@1.8.0/test/spec/upload.browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
describe("tus",function(){describe("#Upload",function(){beforeEach(function(){jasmine.Ajax.install(),SynchronousPromise.installGlobally(),localStorage.clear()}),afterEach(function(){jasmine.Ajax.uninstall(),SynchronousPromise.uninstallGlobally()}),it("should resume an upload from a stored url",function(e){localStorage.setItem("fingerprinted","http://tus.io/uploads/resuming");var t=new Blob("hello world".split("")),s={endpoint:"http://tus.io/uploads",onProgress:function(){},fingerprint:function(e,t,s){s(null,"fingerprinted")}};spyOn(s,"fingerprint").and.callThrough(),spyOn(s,"onProgress");var o=new tus.Upload(t,s);o.start(),expect(s.fingerprint).toHaveBeenCalled();var r=jasmine.Ajax.requests.mostRecent();expect(r.url).toBe("http://tus.io/uploads/resuming"),expect(r.method).toBe("HEAD"),expect(r.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),r.respondWith({status:204,responseHeaders:{"Upload-Length":11,"Upload-Offset":3}}),expect(o.url).toBe("http://tus.io/uploads/resuming"),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/resuming"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(r.requestHeaders["Upload-Offset"]).toBe(3),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params.size).toBe(8),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,11),e()}),describe("storing of upload urls",function(){var e={endpoint:"http://tus.io/uploads",fingerprint:function(e,t,s){s(null,"fingerprinted")}},t=function(){var t=new Blob("hello world".split(""));spyOn(e,"fingerprint").and.callThrough();var s=new tus.Upload(t,e);s.start(),expect(e.fingerprint).toHaveBeenCalled();var o=jasmine.Ajax.requests.mostRecent();expect(o.url).toBe("http://tus.io/uploads"),expect(o.method).toBe("POST"),o.respondWith({status:201,responseHeaders:{Location:"/uploads/blargh"}}),expect(s.url).toBe("http://tus.io/uploads/blargh")},s=function(){var e=jasmine.Ajax.requests.mostRecent();expect(e.url).toBe("http://tus.io/uploads/blargh"),expect(e.method).toBe("PATCH"),e.respondWith({status:204,responseHeaders:{"Upload-Offset":11}})};it("should store and retain with default options",function(e){t(),expect(localStorage.getItem("fingerprinted")).toBe("http://tus.io/uploads/blargh"),s(),expect(localStorage.getItem("fingerprinted")).toBe("http://tus.io/uploads/blargh"),e()}),it("should store and remove with option removeFingerprintOnSuccess set",function(o){e.removeFingerprintOnSuccess=!0,t(),expect(localStorage.getItem("fingerprinted")).toBe("http://tus.io/uploads/blargh"),s(),expect(localStorage.getItem("fingerprinted")).toBe(null),o()})}),it("should delete upload urls on a 4XX",function(e){localStorage.setItem("fingerprinted","http://tus.io/uploads/resuming");var t=new Blob("hello world".split("")),s={endpoint:"http://tus.io/uploads",fingerprint:function(e,t,s){s(null,"fingerprinted")}};spyOn(s,"fingerprint").and.callThrough(),new tus.Upload(t,s).start();var o=jasmine.Ajax.requests.mostRecent();expect(o.url).toBe("http://tus.io/uploads/resuming"),expect(o.method).toBe("HEAD"),o.respondWith({status:400}),expect(localStorage.getItem("fingerprinted")).toBe(null),e()}),it("should upload data from a reader",function(e){var t={value:"hello world".split(""),read:function(){if(this.value){var e=this.value;return this.value=null,Promise.resolve({value:e,done:!1})}return Promise.resolve({value:void 0,done:!0})}},s={endpoint:"http://tus.io/uploads",chunkSize:100,onProgress:function(){},fingerprint:function(e,t,s){s(null,"fingerprinted")},uploadLengthDeferred:!0};spyOn(s,"fingerprint").and.callThrough(),spyOn(s,"onProgress");var o=new tus.Upload(t,s);o.start(),expect(s.fingerprint).toHaveBeenCalledWith(t,o.options,jasmine.any(Function));var r=jasmine.Ajax.requests.mostRecent();expect(r.url).toBe("http://tus.io/uploads"),expect(r.method).toBe("POST"),expect(r.requestHeaders["Upload-Length"]).toBe(void 0),expect(r.requestHeaders["Upload-Defer-Length"]).toBe(1),r.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh"}}),expect(o.url).toBe("http://tus.io/uploads/blargh"),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(0),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params.length).toBe(11),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,null),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(11),expect(r.requestHeaders["Upload-Length"]).toBe(11),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params).toBe(void 0),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,11),e()}),it("should upload a reader in chunks",function(e){var t={value:"hello world".split(""),read:function(){if(this.value){var e=this.value;return this.value=null,Promise.resolve({value:e,done:!1})}return Promise.resolve({value:void 0,done:!0})}},s={endpoint:"http://tus.io/uploads",chunkSize:6,onProgress:function(){},fingerprint:function(e,t,s){s(null,"fingerprinted")},uploadLengthDeferred:!0};spyOn(s,"fingerprint").and.callThrough(),spyOn(s,"onProgress");var o=new tus.Upload(t,s);o.start(),expect(s.fingerprint).toHaveBeenCalledWith(t,o.options,jasmine.any(Function));var r=jasmine.Ajax.requests.mostRecent();expect(r.url).toBe("http://tus.io/uploads"),expect(r.method).toBe("POST"),expect(r.requestHeaders["Upload-Length"]).toBe(void 0),expect(r.requestHeaders["Upload-Defer-Length"]).toBe(1),r.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh"}}),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(0),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params.length).toBe(6),r.respondWith({status:204,responseHeaders:{"Upload-Offset":6}}),expect(s.onProgress).toHaveBeenCalledWith(6,null),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(6),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params.length).toBe(5),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,null),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(11),expect(r.requestHeaders["Upload-Length"]).toBe(11),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params).toBe(void 0),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,11),e()}),it("should fill chunkSize from a reader",function(e){var t={value:"hello world".split(""),read:function(){var e,t=!1;return this.value.length>0?(e=this.value.slice(0,1),this.value=this.value.slice(1)):t=!0,Promise.resolve({value:e,done:t})}},s={endpoint:"http://tus.io/uploads",chunkSize:6,onProgress:function(){},fingerprint:function(e,t,s){s(null,"fingerprinted")},uploadLengthDeferred:!0};spyOn(s,"fingerprint").and.callThrough(),spyOn(s,"onProgress");var o=new tus.Upload(t,s);o.start(),expect(s.fingerprint).toHaveBeenCalledWith(t,o.options,jasmine.any(Function));var r=jasmine.Ajax.requests.mostRecent();expect(r.url).toBe("http://tus.io/uploads"),expect(r.method).toBe("POST"),expect(r.requestHeaders["Upload-Length"]).toBe(void 0),expect(r.requestHeaders["Upload-Defer-Length"]).toBe(1),r.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh"}}),expect(o.url).toBe("http://tus.io/uploads/blargh"),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(0),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params.length).toBe(6),r.respondWith({status:204,responseHeaders:{"Upload-Offset":6}}),expect(s.onProgress).toHaveBeenCalledWith(6,null),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(r.requestHeaders["Upload-Offset"]).toBe(6),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params.length).toBe(5),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,null),r=jasmine.Ajax.requests.mostRecent(),expect(r.url).toBe("http://tus.io/uploads/blargh"),expect(r.method).toBe("PATCH"),expect(r.requestHeaders["Upload-Offset"]).toBe(11),expect(r.requestHeaders["Upload-Length"]).toBe(11),expect(r.contentType()).toBe("application/offset+octet-stream"),expect(r.params).toBe(void 0),r.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onProgress).toHaveBeenCalledWith(11,11),e()}),it("should retry the upload with a reader",function(e){var t={value:"hello world".split(""),read:function(){var e,t=!1;return this.value.length>0?(e=this.value.slice(0,1),this.value=this.value.slice(1)):t=!0,Promise.resolve({value:e,done:t})}},s={endpoint:"http://tus.io/files/",chunkSize:11,retryDelays:[10,10,10],onSuccess:function(){},uploadLengthDeferred:!0};spyOn(s,"onSuccess"),new tus.Upload(t,s).start();var o=jasmine.Ajax.requests.mostRecent();expect(o.url).toBe("http://tus.io/files/"),expect(o.method).toBe("POST"),o.respondWith({status:500}),setTimeout(function(){o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/"),expect(o.method).toBe("POST"),o.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),expect(o.requestHeaders["Upload-Length"]).toBe(11),o.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onSuccess).toHaveBeenCalled(),e()},20)}),it("should retry failed chunks with a reader",function(e){var t={value:"hello world".split(""),read:function(){var e,t=!1;return this.value.length>0?(e=this.value.slice(0,1),this.value=this.value.slice(1)):t=!0,Promise.resolve({value:e,done:t})}},s={endpoint:"http://tus.io/files/",chunkSize:11,retryDelays:[10,10,10],onSuccess:function(){},uploadLengthDeferred:!0};spyOn(s,"onSuccess"),new tus.Upload(t,s).start();var o=jasmine.Ajax.requests.mostRecent();expect(o.url).toBe("http://tus.io/files/"),expect(o.method).toBe("POST"),o.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:500}),setTimeout(function(){o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("HEAD"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":0}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),expect(o.requestHeaders["Upload-Length"]).toBe(11),o.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onSuccess).toHaveBeenCalled(),e()},20)}),it("should retry failed chunks in the middle of a reader",function(e){var t={value:"hello there world!".split(""),read:function(){var e,t=!1;return this.value?(e=this.value,this.value=void 0):t=!0,Promise.resolve({value:e,done:t})}},s={endpoint:"http://tus.io/files/",chunkSize:6,retryDelays:[10,10,10],onSuccess:function(){},uploadLengthDeferred:!0};spyOn(s,"onSuccess"),new tus.Upload(t,s).start();var o=jasmine.Ajax.requests.mostRecent();expect(o.url).toBe("http://tus.io/files/"),expect(o.method).toBe("POST"),o.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":6}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:500}),setTimeout(function(){o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("HEAD"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":6}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":12}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),o.respondWith({status:204,responseHeaders:{"Upload-Offset":18}}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/files/foo"),expect(o.method).toBe("PATCH"),expect(o.requestHeaders["Upload-Length"]).toBe(18),o.respondWith({status:204,responseHeaders:{"Upload-Offset":18}}),expect(s.onSuccess).toHaveBeenCalled(),e()},20)}),it("should cancel the reader when aborted",function(e){var t={value:"hello there world!".split(""),read:function(){var e,t=!1;return this.value?(e=this.value,this.value=void 0):t=!0,Promise.resolve({value:e,done:t})},cancel:function(){}};spyOn(t,"cancel");var s=new tus.Upload(t,{endpoint:"http://tus.io/files/",chunkSize:6,retryDelays:[10,10,10],onSuccess:function(){},uploadLengthDeferred:!0});s.start(),s.abort(),expect(t.cancel).toHaveBeenCalled(),e()}),describe("resolving of URIs",function(){if(navigator.userAgent.indexOf("Trident/")>0)console.log("Skipping tests for React Native in Internet Explorer");else{var e=navigator.product;beforeEach(function(){Object.defineProperty(navigator,"product",{value:"ReactNative",configurable:!0})}),afterEach(function(){Object.defineProperty(navigator,"product",{value:e,configurable:!0})}),it("should upload a file from an URI",function(e){localStorage.setItem("fingerprinted","http://tus.io/uploads/resuming");var t={endpoint:"http://tus.io/uploads",onSuccess:function(){}};spyOn(t,"onSuccess");var s=new tus.Upload({uri:"file:///my/file.dat"},t);s.start();var o=jasmine.Ajax.requests.mostRecent();expect(o.url).toBe("file:///my/file.dat"),expect(o.method).toBe("GET"),expect(o.responseType).toBe("blob"),o.respondWith({status:200,responseHeaders:{"Upload-Length":11,"Upload-Offset":3},response:new Blob("hello world".split(""))}),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/uploads"),expect(o.method).toBe("POST"),expect(o.requestHeaders["Upload-Length"]).toBe(11),o.respondWith({status:201,responseHeaders:{Location:"/uploads/blargh"}}),expect(s.url).toBe("http://tus.io/uploads/blargh"),o=jasmine.Ajax.requests.mostRecent(),expect(o.url).toBe("http://tus.io/uploads/blargh"),expect(o.method).toBe("PATCH"),expect(o.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(o.requestHeaders["Upload-Offset"]).toBe(0),expect(o.contentType()).toBe("application/offset+octet-stream"),expect(o.params.size).toBe(11),o.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(t.onSuccess).toHaveBeenCalledWith(),e()}),it("should emit an error if it can't resolve the URI",function(e){localStorage.setItem("fingerprinted","http://tus.io/uploads/resuming");var t={endpoint:"http://tus.io/uploads",onError:function(){}};spyOn(t,"onError"),new tus.Upload({uri:"file:///my/file.dat"},t).start();var s=jasmine.Ajax.requests.mostRecent();expect(s.url).toBe("file:///my/file.dat"),expect(s.method).toBe("GET"),expect(s.responseType).toBe("blob"),s.responseError(),expect(t.onError).toHaveBeenCalledWith(new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. [object Object]")),e()})}})})});
//# sourceMappingURL=/sm/7c9f321ce4b49fe702ec9c847b8733104aabb9b10edf654f1e85c99aaa28f55e.map