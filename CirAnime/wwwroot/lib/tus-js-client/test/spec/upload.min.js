/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/tus-js-client@1.8.0/test/spec/upload.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var isBrowser="undefined"!=typeof window,isNode=!isBrowser;if(isNode)var axios=require("axios"),tus=require("../../"),SynchronousPromise=require("synchronous-promise").SynchronousPromise;var getBlob=function(e){return isNode?Buffer.from(e):new Blob(e.split(""))},getStorage=function(){if(isNode){var e=require("temp").path();return new tus.FileStorage(e)}return null};function validateUploadContent(e,t){axios.get(e.url).then(function(o){expect(o.status).toBe(200),expect(o.data).toBe("hello world"),validateUploadMetadata(e,t)}).catch(t)}function validateUploadMetadata(e,t){axios.head(e.url,{headers:{"Tus-Resumable":"1.0.0"}}).then(function(e){expect(e.status).toBe(200),expect(e.data).toBe(""),expect(e.headers["tus-resumable"]).toBe("1.0.0"),expect(e.headers["upload-offset"]).toBe("11"),expect(e.headers["upload-length"]).toBe("11");var o=e.headers["upload-metadata"];expect(o).toBeTruthy();var s=o.split(",");expect(s).toContain("filename aGVsbG8udHh0"),expect(s).toContain("filetype dGV4dC9wbGFpbg=="),expect(s).toContain("nonlatin c8WCb8WEY2U="),expect(s).toContain("number MTAw"),expect(s.length).toBe(4),t()}).catch(t)}function validateUploadDeletion(e,t){axios.get(e.url,{validateStatus:function(e){return 404===e}}).then(function(e){expect(e.status).toBe(404),t()}).catch(t.fail)}function waitTillNextReq(e,t,o,s){(s=s||0)>=5?fail(new Error("call level exceeded")):setTimeout(function(){var n=jasmine.Ajax.requests.mostRecent();if((!t||t&&n!=t)&&n&&0===n.url.indexOf(e))return o(n);waitTillNextReq(e,t,o,s+1)},20)}jasmine.DEFAULT_TIMEOUT_INTERVAL=2e4,describe("tus",function(){describe("#isSupported",function(){it("should be true",function(){expect(tus.isSupported).toBe(!0)})}),describe("#Upload",function(){beforeEach(function(){jasmine.Ajax.install(),SynchronousPromise.installGlobally(),isBrowser&&localStorage.clear()}),afterEach(function(){jasmine.Ajax.uninstall(),SynchronousPromise.uninstallGlobally()}),it("should throw if no error handler is available",function(){var e=new tus.Upload(null);expect(e.start.bind(e)).toThrowError("tus: no file or stream to upload provided")}),it("should throw if no endpoint and upload URL is provided",function(){var e=getBlob("hello world"),t=new tus.Upload(e);expect(t.start.bind(t)).toThrowError("tus: neither an endpoint or an upload URL is provided")}),it("should upload a file",function(e){var t,o,s=getBlob("hello world"),n="http://files.tus.io",r={endpoint:n+"/uploads",headers:{Custom:"blargh"},metadata:{foo:"hello",bar:"world",nonlatin:"słońce",number:100},withCredentials:!0,urlStorage:getStorage(),onProgress:function(){},fingerprint:function(e,s,n){t=s,o=e,n(null,"fingerprinted")}};spyOn(r,"fingerprint").and.callThrough(),spyOn(r,"onProgress");var a=new tus.Upload(s,r);a.start(),expect(r.fingerprint).toHaveBeenCalled(),expect(t).toBe(a.options),expect(o).toBe(s),waitTillNextReq(n,null,function(t){expect(t.url).toBe(n+"/uploads"),expect(t.method).toBe("POST"),expect(t.requestHeaders.Custom).toBe("blargh"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Length"]).toBe(11),isBrowser&&expect(t.withCredentials).toBe(!0),expect(t.requestHeaders["Upload-Metadata"]).toBe("foo aGVsbG8=,bar d29ybGQ=,nonlatin c8WCb8WEY2U=,number MTAw"),t.respondWith({status:201,responseHeaders:{Location:n+"/uploads/blargh"}}),expect(a.url).toBe(n+"/uploads/blargh"),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(n+"/uploads/blargh"),expect(t.method).toBe("PATCH"),expect(t.requestHeaders.Custom).toBe("blargh"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Offset"]).toBe(0),expect(t.contentType()).toBe("application/offset+octet-stream"),expect(t.params.size).toBe(11),isBrowser&&expect(t.withCredentials).toBe(!0),t.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(r.onProgress).toHaveBeenCalledWith(11,11),e()})}),it("should create an upload if resuming fails",function(e){var t=getBlob("hello world"),o=new tus.Upload(t,{endpoint:"http://tus.io/uploads",uploadUrl:"http://tus.io/uploads/resuming"});o.start();var s=jasmine.Ajax.requests.mostRecent();expect(s.url).toBe("http://tus.io/uploads/resuming"),expect(s.method).toBe("HEAD"),expect(s.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),s.respondWith({status:404}),expect(o.url).toBe(null),s=jasmine.Ajax.requests.mostRecent(),expect(s.url).toBe("http://tus.io/uploads"),expect(s.method).toBe("POST"),expect(s.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(s.requestHeaders["Upload-Length"]).toBe(11),e()}),it("should create an upload with the full data",function(e){var t=getBlob("hello world"),o={endpoint:"http://tus.io/uploads",uploadDataDuringCreation:!0,onProgress:function(){},onChunkComplete:function(){},onSuccess:function(){}};spyOn(o,"onProgress"),spyOn(o,"onChunkComplete"),spyOn(o,"onSuccess");var s=new tus.Upload(t,o);s.start();var n=jasmine.Ajax.requests.mostRecent();expect(n.url).toBe("http://tus.io/uploads"),expect(n.method).toBe("POST"),expect(n.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(n.requestHeaders["Upload-Length"]).toBe(11),expect(n.contentType()).toBe("application/offset+octet-stream"),expect(n.params.size).toBe(11),n.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh","Upload-Offset":11}}),expect(o.onProgress).toHaveBeenCalledWith(11,11),expect(o.onChunkComplete).toHaveBeenCalledWith(11,11,11),expect(o.onSuccess).toHaveBeenCalled(),expect(s.url).toBe("http://tus.io/uploads/blargh"),e()}),it("should create an upload with partial data and continue",function(e){var t=getBlob("hello world"),o={endpoint:"http://tus.io/uploads",uploadDataDuringCreation:!0,chunkSize:6,onProgress:function(){},onChunkComplete:function(){},onSuccess:function(){}};spyOn(o,"onProgress"),spyOn(o,"onChunkComplete"),spyOn(o,"onSuccess");var s=new tus.Upload(t,o);s.start();var n=jasmine.Ajax.requests.mostRecent();expect(n.url).toBe("http://tus.io/uploads"),expect(n.method).toBe("POST"),expect(n.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(n.requestHeaders["Upload-Length"]).toBe(11),expect(n.contentType()).toBe("application/offset+octet-stream"),expect(n.params.size).toBe(6),n.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh","Upload-Offset":6}}),expect(o.onProgress).toHaveBeenCalledWith(6,11),expect(o.onChunkComplete).toHaveBeenCalledWith(6,6,11),expect(o.onSuccess).not.toHaveBeenCalled(),expect(s.url).toBe("http://tus.io/uploads/blargh"),n=jasmine.Ajax.requests.mostRecent(),expect(n.url).toBe("http://tus.io/uploads/blargh"),expect(n.method).toBe("PATCH"),expect(n.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(n.requestHeaders["Upload-Offset"]).toBe(6),expect(n.contentType()).toBe("application/offset+octet-stream"),expect(n.params.size).toBe(5),n.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh","Upload-Offset":11}}),expect(o.onProgress).toHaveBeenCalledWith(11,11),expect(o.onChunkComplete).toHaveBeenCalledWith(5,11,11),expect(o.onSuccess).toHaveBeenCalled(),e()}),it("should add the request's body to errors",function(){var e,t=getBlob("hello world"),o={endpoint:"http://tus.io/uploads",onError:function(t){e=t}};new tus.Upload(t,o).start();var s=jasmine.Ajax.requests.mostRecent();expect(s.url).toBe("http://tus.io/uploads"),expect(s.method).toBe("POST"),s.respondWith({status:500,responseText:"server_error"}),expect(e.message).toBe("tus: unexpected response while creating upload, originated from request (response code: 500, response text: server_error)"),expect(e.originalRequest).toBeDefined()}),it("should throw an error if resuming fails and no endpoint is provided",function(e){var t=getBlob("hello world"),o={uploadUrl:"http://tus.io/uploads/resuming",onError:function(){}};spyOn(o,"onError"),new tus.Upload(t,o).start();var s=jasmine.Ajax.requests.mostRecent();expect(s.url).toBe("http://tus.io/uploads/resuming"),expect(s.method).toBe("HEAD"),expect(s.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),s.respondWith({status:404}),expect(o.onError).toHaveBeenCalledWith(new Error("tus: unable to resume upload (new upload cannot be created without an endpoint), originated from request (response code: 404, response text: )")),e()}),it("should resolve relative URLs",function(e){var t=getBlob("hello world"),o="http://relative.tus.io:1080",s={endpoint:o+"/files/"},n=new tus.Upload(t,s);n.start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:201,responseHeaders:{Location:"//localhost/uploads/foo"}}),expect(n.url).toBe("http://localhost/uploads/foo"),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe("http://localhost/uploads/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),e()})}),it("should upload a file in chunks",function(e){var t,o,s="http://chunks.tus.io",n=getBlob("hello world"),r={endpoint:s+"/uploads",chunkSize:7,urlStorage:getStorage(),onProgress:function(){},onChunkComplete:function(){},fingerprint:function(e,s,n){t=s,o=e,n(null,"fingerprinted")}};spyOn(r,"fingerprint").and.callThrough(),spyOn(r,"onProgress"),spyOn(r,"onChunkComplete");var a=new tus.Upload(n,r);a.start(),expect(r.fingerprint).toHaveBeenCalled(),expect(t).toBe(a.options),expect(o).toBe(n),waitTillNextReq(s,null,function(t){expect(t.url).toBe(s+"/uploads"),expect(t.method).toBe("POST"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Length"]).toBe(11),t.respondWith({status:201,responseHeaders:{Location:"/uploads/blargh"}}),expect(a.url).toBe(s+"/uploads/blargh"),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(s+"/uploads/blargh"),expect(t.method).toBe("PATCH"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Offset"]).toBe(0),expect(t.contentType()).toBe("application/offset+octet-stream"),expect(t.params.size).toBe(7),t.respondWith({status:204,responseHeaders:{"Upload-Offset":7}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(s+"/uploads/blargh"),expect(t.method).toBe("PATCH"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Offset"]).toBe(7),expect(t.contentType()).toBe("application/offset+octet-stream"),expect(t.params.size).toBe(4),t.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(r.onProgress).toHaveBeenCalledWith(11,11),expect(r.onChunkComplete).toHaveBeenCalledWith(7,7,11),expect(r.onChunkComplete).toHaveBeenCalledWith(4,11,11),e()})}),it("should add the original request to errors",function(e){var t,o=getBlob("hello world"),s="http://original.tus.io",n={endpoint:s+"/uploads",onError:function(e){t=e}},r=new tus.Upload(o,n);r.start(),waitTillNextReq(s,null,function(o){expect(o.url).toBe(s+"/uploads"),expect(o.method).toBe("POST"),o.respondWith({status:500,responseHeaders:{Custom:"blargh"}}),expect(r.url).toBe(null),expect(t.message).toBe("tus: unexpected response while creating upload, originated from request (response code: 500, response text: )"),expect(t.originalRequest).toBeDefined(),expect(t.originalRequest.getResponseHeader("Custom")).toBe("blargh"),e()})}),it("should only create an upload for empty files",function(e){var t=getBlob(""),o="http://empty.tus.io",s={endpoint:o+"/uploads",onSuccess:function(){}};spyOn(s,"onSuccess"),new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/uploads"),expect(t.method).toBe("POST"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Length"]).toBe(0),t.respondWith({status:201,responseHeaders:{Location:o+"/uploads/empty"}}),expect(s.onSuccess).toHaveBeenCalled(),e()})}),it("should not resume a finished upload",function(e){var t=getBlob("hello world"),o={endpoint:"http://tus.io/uploads",onProgress:function(){},onSuccess:function(){},uploadUrl:"http://tus.io/uploads/resuming"};spyOn(o,"onProgress"),spyOn(o,"onSuccess"),new tus.Upload(t,o).start();var s=jasmine.Ajax.requests.mostRecent();expect(s.url).toBe("http://tus.io/uploads/resuming"),expect(s.method).toBe("HEAD"),expect(s.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),s.respondWith({status:204,responseHeaders:{"Upload-Length":"11","Upload-Offset":"11"}}),expect(o.onProgress).toHaveBeenCalledWith(11,11),expect(o.onSuccess).toHaveBeenCalled(),e()}),it("should resume an upload from a specified url",function(e){var t=getBlob("hello world"),o={endpoint:"http://tus.io/uploads",uploadUrl:"http://tus.io/files/upload",onProgress:function(){},fingerprint:function(e,t,o){o(null,"fingerprinted")}};spyOn(o,"fingerprint").and.callThrough(),spyOn(o,"onProgress");var s=new tus.Upload(t,o);s.start(),expect(o.fingerprint.calls.count()).toEqual(0),expect(s.url).toBe("http://tus.io/files/upload");var n=jasmine.Ajax.requests.mostRecent();expect(n.url).toBe("http://tus.io/files/upload"),expect(n.method).toBe("HEAD"),expect(n.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),n.respondWith({status:204,responseHeaders:{"Upload-Length":11,"Upload-Offset":3}}),n=jasmine.Ajax.requests.mostRecent(),expect(n.url).toBe("http://tus.io/files/upload"),expect(n.method).toBe("PATCH"),expect(n.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(n.requestHeaders["Upload-Offset"]).toBe(3),expect(n.contentType()).toBe("application/offset+octet-stream"),expect(n.params.size).toBe(8),n.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(o.onProgress).toHaveBeenCalledWith(11,11),e()}),it("should resume a previously started upload",function(e){var t=getBlob("hello world"),o={resume:!1,endpoint:"http://tus.io/uploads",onSuccess:function(){}};spyOn(o,"onSuccess");var s=new tus.Upload(t,o);s.start();var n=jasmine.Ajax.requests.mostRecent();expect(n.url).toBe("http://tus.io/uploads"),expect(n.method).toBe("POST"),n.respondWith({status:201,responseHeaders:{Location:"http://tus.io/uploads/blargh"}}),n=jasmine.Ajax.requests.mostRecent(),expect(n.url).toBe("http://tus.io/uploads/blargh"),expect(n.method).toBe("PATCH"),s.abort(),n.respondWith({status:204,responseHeaders:{"Upload-Offset":5}}),s.start(),n=jasmine.Ajax.requests.mostRecent(),expect(n.url).toBe("http://tus.io/uploads/blargh"),expect(n.method).toBe("HEAD"),n.respondWith({status:204,responseHeaders:{"Upload-Offset":5,"Upload-Length":11}}),n=jasmine.Ajax.requests.mostRecent(),expect(n.url).toBe("http://tus.io/uploads/blargh"),expect(n.method).toBe("PATCH"),n.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(o.onSuccess).toHaveBeenCalled(),e()}),it("should override the PATCH method",function(e){var t=getBlob("hello world"),o="http://override.tus.io",s={endpoint:o+"/uploads",uploadUrl:o+"/files/upload",overridePatchMethod:!0};new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/upload"),expect(t.method).toBe("HEAD"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),t.respondWith({status:204,responseHeaders:{"Upload-Length":11,"Upload-Offset":3}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/upload"),expect(t.method).toBe("POST"),expect(t.requestHeaders["Tus-Resumable"]).toBe("1.0.0"),expect(t.requestHeaders["Upload-Offset"]).toBe(3),expect(t.requestHeaders["X-HTTP-Method-Override"]).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),e()})}),it("should emit an error if an upload is locked",function(e){var t=getBlob("hello world"),o="http://locked.tus.io",s={endpoint:o+"/uploads",uploadUrl:o+"/files/upload",onError:function(){}};spyOn(s,"onError"),new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/upload"),expect(t.method).toBe("HEAD"),t.respondWith({status:423}),expect(s.onError).toHaveBeenCalledWith(new Error("tus: upload is currently locked; retry later, originated from request (response code: 423, response text: )")),e()})}),it("should emit an error if no Location header is presented",function(e){var t=getBlob("hello world"),o="http://emit.tus.io",s={endpoint:o+"/uploads",onError:function(){}};spyOn(s,"onError"),new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/uploads"),expect(t.method).toBe("POST"),t.respondWith({status:201}),expect(s.onError).toHaveBeenCalledWith(new Error("tus: invalid or missing Location header, originated from request (response code: 201, response text: )")),e()})}),it("should throw if retryDelays is not an array",function(){var e=getBlob("hello world"),t=new tus.Upload(e,{endpoint:"http://endpoint/",retryDelays:44});expect(t.start.bind(t)).toThrowError("tus: the `retryDelays` option must either be an array or null")}),it("should retry the upload",function(e){var t=getBlob("hello world"),o="http://retry.tus.io",s={endpoint:o+"/files/",retryDelays:[10,10,10],onSuccess:function(){}};spyOn(s,"onSuccess"),new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:500}),setTimeout(function(){t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:423}),setTimeout(function(){t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("HEAD"),t.respondWith({status:201,responseHeaders:{"Upload-Offset":0,"Upload-Length":11}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:409}),setTimeout(function(){t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("HEAD"),t.respondWith({status:201,responseHeaders:{"Upload-Offset":0,"Upload-Length":11}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onSuccess).toHaveBeenCalled(),e()},20)},20)},20)})}),it("should not retry if the error has not been caused by a request",function(e){var t=getBlob("hello world"),o={endpoint:"http://tus.io/files/",retryDelays:[10,10,10],onSuccess:function(){},onError:function(){}};spyOn(o,"onSuccess"),spyOn(o,"onError");var s=new tus.Upload(t,o);spyOn(s,"_createUpload"),s.start(),setTimeout(function(){var t=new Error("custom error");s._emitError(t),expect(s._createUpload).toHaveBeenCalledTimes(1),expect(o.onError).toHaveBeenCalledWith(t),expect(o.onSuccess).not.toHaveBeenCalled(),e()},200)}),it("should stop retrying after all delays have been used",function(e){var t=getBlob("hello world"),o="http://delays.tus.io",s={endpoint:o+"/files/",retryDelays:[10],onSuccess:function(){},onError:function(){}};spyOn(s,"onSuccess"),spyOn(s,"onError"),new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:500}),setTimeout(function(){expect(s.onError).not.toHaveBeenCalled();var t=jasmine.Ajax.requests.mostRecent();expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:500}),expect(s.onSuccess).not.toHaveBeenCalled(),expect(s.onError).toHaveBeenCalledTimes(1),e()},200)})}),it("should stop retrying when the abort function is called",function(e){var t=getBlob("hello world"),o="http://noretry.tus.io",s={endpoint:o+"/files/",retryDelays:[100],onError:function(){}};spyOn(s,"onError");var n=new tus.Upload(t,s);n.start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),spyOn(n,"start"),t.respondWith({status:500}),n.abort(),setTimeout(function(){expect(n.start).not.toHaveBeenCalled(),e()},200)})}),it("should stop upload when the abort function is called during a callback",function(e){var t,o="http://abort2.tus.io",s=getBlob("hello world"),n={endpoint:o+"/files/",chunkSize:5,onChunkComplete:function(){t.abort()}};spyOn(n,"onChunkComplete").and.callThrough(),(t=new tus.Upload(s,n)).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":5}}),setTimeout(function(){expect(n.onChunkComplete).toHaveBeenCalled(),expect(jasmine.Ajax.requests.mostRecent()).toBe(t),e()},200)})}),it("should terminate upload when abort is called with true",function(e){var t,o="http://abort2.tus.io",s=getBlob("hello world"),n=!1,r={endpoint:o+"/files/",chunkSize:5,onChunkComplete:function(){t.abort(!0,function(){n=!0})}};spyOn(r,"onChunkComplete").and.callThrough(),(t=new tus.Upload(s,r)).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":5}}),setTimeout(function(){expect(r.onChunkComplete).toHaveBeenCalled(),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("DELETE"),t.respondWith({status:204}),expect(n).toBe(!0),e()},200)})}),it("should stop upload when the abort function is called during the POST request",function(e){var t=getBlob("hello world"),o="http://abort.tus.io",s={endpoint:o+"/files/",onError:function(){}};spyOn(s,"onError");var n=new tus.Upload(t,s);n.start(),n.abort(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),setTimeout(function(){expect(s.onError).not.toHaveBeenCalled(),expect(jasmine.Ajax.requests.mostRecent()).toBe(t),e()},200)})}),it("should reset the attempt counter if an upload proceeds",function(e){var t=getBlob("hello world"),o="http://reset.tus.io",s={endpoint:o+"/files/",retryDelays:[10],onError:function(){},onSuccess:function(){}};spyOn(s,"onError"),spyOn(s,"onSuccess"),new tus.Upload(t,s).start(),waitTillNextReq(o,null,function(t){expect(t.url).toBe(o+"/files/"),expect(t.method).toBe("POST"),t.respondWith({status:201,responseHeaders:{Location:"/files/foo"}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:500}),setTimeout(function(){t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("HEAD"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":0,"Upload-Length":11}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":5}}),waitTillNextReq(o,t,function(t){expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:500}),setTimeout(function(){t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("HEAD"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":5,"Upload-Length":11}}),t=jasmine.Ajax.requests.mostRecent(),expect(t.url).toBe(o+"/files/foo"),expect(t.method).toBe("PATCH"),t.respondWith({status:204,responseHeaders:{"Upload-Offset":11}}),expect(s.onError).not.toHaveBeenCalled(),expect(s.onSuccess).toHaveBeenCalled(),e()},20)})},20)})})}),it("should upload to a real tus server",function(e){var t=getBlob("hello world"),o={resume:!1,endpoint:"https://master.tus.io/files/",metadata:{nonlatin:"słońce",number:100,filename:"hello.txt",filetype:"text/plain"},onSuccess:function(){expect(s.url).toMatch(/^https:\/\/master\.tus\.io\/files\//),console.log("Upload URL:",s.url),validateUploadContent(s,function(t){t?e.fail(t):s.abort(!0,function(t){t?e.fail(t):validateUploadDeletion(s,e)})})},onError:function(t){e.fail(t)}},s=new tus.Upload(t,o);s.start()}),it("should upload to a real tus server with creation-with-upload",function(e){var t=getBlob("hello world"),o={resume:!1,endpoint:"https://master.tus.io/files/",uploadDataDuringCreation:!0,metadata:{nonlatin:"słońce",number:100,filename:"hello.txt",filetype:"text/plain"},onSuccess:function(){expect(s.url).toMatch(/^https:\/\/master\.tus\.io\/files\//),console.log("Upload URL:",s.url),validateUploadContent(s,e)},onError:function(t){e.fail(t)}},s=new tus.Upload(t,o);s.start()})});
//# sourceMappingURL=/sm/d021948e2a269abdce055a5c1d8bb3b75f218f5fc8962baf9a4485393469abff.map