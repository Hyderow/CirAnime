/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/tus-js-client@1.8.0/lib.es5/node/source.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();exports.getSource=getSource;var _stream=require("stream"),_fs=require("fs");function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var BufferSource=function(){function e(t){_classCallCheck(this,e),this._buffer=t,this.size=t.length}return _createClass(e,[{key:"slice",value:function(e,t,n){var s=this._buffer.slice(e,t);s.size=s.length,n(null,s)}},{key:"close",value:function(){}}]),e}(),FileSource=function(){function e(t){_classCallCheck(this,e),this._stream=t,this._path=t.path.toString()}return _createClass(e,[{key:"slice",value:function(e,t,n){var s=(0,_fs.createReadStream)(this._path,{start:e,end:t-1,autoClose:!0});s.size=t-e,n(null,s)}},{key:"close",value:function(){this._stream.destroy()}}]),e}(),StreamSource=function(){function e(t,n){var s=this;if(_classCallCheck(this,e),n=+n,!isFinite(n))throw new Error("cannot create source for stream without a finite value for the `chunkSize` option");this._stream=t,this.size=null,t.pause(),this._done=!1,t.on("end",function(){return s._done=!0}),this._buf=Buffer.alloc(n),this._bufPos=null,this._bufLen=0}return _createClass(e,[{key:"slice",value:function(e,t,n){if(e>=this._bufPos&&e<this._bufPos+this._bufLen){var s=e-this._bufPos,r=Math.min(this._bufLen,t-this._bufPos),i=this._buf.slice(s,r);return i.size=i.length,void n(null,i)}if(e<this._bufPos)n(new Error("cannot slice from position which we already seeked away"));else if(this._done)n(null,null,this._done);else{var o=e-(this._bufPos+this._bufLen);this._bufLen=0,this._bufPos=e;var u=new SlicingStream(o,t-e,this);this._stream.pipe(u),n(null,u)}}},{key:"close",value:function(){}}]),e}(),SlicingStream=function(e){function t(e,n,s){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._bytesToSkip=e,r._bytesToRead=n,r._source=s,r}return _inherits(t,_stream.Transform),_createClass(t,[{key:"_transform",value:function(e,t,n){var s=Math.min(this._bytesToSkip,e.length);this._bytesToSkip-=s;var r=e.length-s;if(0!==r){var i=Math.min(this._bytesToRead,r);if(this._bytesToRead-=i,0!==i){var o=e.slice(s,s+i);this._source._bufLen+=o.copy(this._source._buf,this._source._bufLen),this.push(o)}if(0===this._bytesToRead&&(this._source._stream.unpipe(this),this.end()),i!==r){var u=e.slice(s+i);this._source._stream.unshift(u)}n(null)}else n(null)}}]),t}();function getSource(e,t,n){return Buffer.isBuffer(e)?n(null,new BufferSource(e)):e instanceof _fs.ReadStream&&null!=e.path?n(null,new FileSource(e)):e instanceof _stream.Readable?n(null,new StreamSource(e,t)):void n(new Error("source object may only be an instance of Buffer or Readable in this environment"))}
//# sourceMappingURL=/sm/971eaecb170761fa70baecb657899a0c55374944a9d95d2af328daf4379e2b8c.map