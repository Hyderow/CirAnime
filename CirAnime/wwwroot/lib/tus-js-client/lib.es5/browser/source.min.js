/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/tus-js-client@1.8.0/lib.es5/browser/source.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(r,t,i){return t&&e(r.prototype,t),i&&e(r,i),r}}();exports.getSource=getSource;var _isReactNative=require("./isReactNative"),_isReactNative2=_interopRequireDefault(_isReactNative),_uriToBlob=require("./uriToBlob"),_uriToBlob2=_interopRequireDefault(_uriToBlob),_isCordova=require("./isCordova"),_isCordova2=_interopRequireDefault(_isCordova),_readAsByteArray=require("./readAsByteArray"),_readAsByteArray2=_interopRequireDefault(_readAsByteArray);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var FileSource=function(){function e(r){_classCallCheck(this,e),this._file=r,this.size=r.size}return _createClass(e,[{key:"slice",value:function(e,r,t){(0,_isCordova2.default)()?(0,_readAsByteArray2.default)(this._file.slice(e,r),function(e,r){if(e)return t(e);t(null,r)}):t(null,this._file.slice(e,r))}},{key:"close",value:function(){}}]),e}(),StreamSource=function(){function e(r,t){_classCallCheck(this,e),this._chunkSize=t,this._buffer=void 0,this._bufferOffset=0,this._reader=r,this._done=!1}return _createClass(e,[{key:"slice",value:function(e,r,t){if(!(e<this._bufferOffset))return this._readUntilEnoughDataOrDone(e,r,t);t(new Error("Requested data is before the reader's current offset"))}},{key:"_readUntilEnoughDataOrDone",value:function(e,r,t){var i=this,n=r<=this._bufferOffset+len(this._buffer);if(this._done||n){var o=this._getDataFromBuffer(e,r);t(null,o,null==o&&this._done)}else this._reader.read().then(function(n){var o=n.value;n.done?i._done=!0:void 0===i._buffer?i._buffer=o:i._buffer=concat(i._buffer,o),i._readUntilEnoughDataOrDone(e,r,t)}).catch(function(e){t(new Error("Error during read: "+e))})}},{key:"_getDataFromBuffer",value:function(e,r){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);var t=0===len(this._buffer);return this._done&&t?null:this._buffer.slice(0,r-e)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}]),e}();function len(e){return void 0===e?0:void 0!==e.size?e.size:e.length}function concat(e,r){if(e.concat)return e.concat(r);if(e instanceof Blob)return new Blob([e,r],{type:e.type});if(e.set){var t=new e.constructor(e.length+r.length);return t.set(e),t.set(r,e.length),t}throw new Error("Unknown data type")}function getSource(e,r,t){if((0,_isReactNative2.default)()&&e&&void 0!==e.uri)(0,_uriToBlob2.default)(e.uri,function(e,r){if(e)return t(new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. "+e));t(null,new FileSource(r))});else{if("function"!=typeof e.slice||void 0===e.size)return"function"==typeof e.read?(r=+r,isFinite(r)?void t(null,new StreamSource(e,r)):void t(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):void t(new Error("source object may only be an instance of File, Blob, or Reader in this environment"));t(null,new FileSource(e))}}
//# sourceMappingURL=/sm/6305401b5745fb3229a4f2b1288b548c1c26af256f646aa4b789f47def949c31.map