/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/tus-js-client@1.8.0/lib/node/storage.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{readFile,writeFile}from"fs";import*as lockfile from"proper-lockfile";import*as combineErrors from"combine-errors";export const canStoreURLs=!0;export function getStorage(){return null}export class FileStorage{constructor(t){this.path=t}setItem(t,e,r){lockfile.lock(this.path,this._lockfileOptions(),(i,o)=>{if(i)return r(i);r=this._releaseAndCb(o,r),this._getData((i,o)=>{if(i)return r(i);o[t]=e,this._writeData(o,t=>r(t))})})}getItem(t,e){this._getData((r,i)=>{if(r)return e(r);e(null,i[t])})}removeItem(t,e){lockfile.lock(this.path,this._lockfileOptions(),(r,i)=>{if(r)return e(r);e=this._releaseAndCb(i,e),this._getData((r,i)=>{if(r)return e(r);delete i[t],this._writeData(i,t=>e(t))})})}_lockfileOptions(){return{realpath:!1,retries:{retries:5,minTimeout:20}}}_releaseAndCb(t,e){return r=>{t(r?t=>{r=t?combineErrors([r,t]):r,e(r)}:e)}}_writeData(t,e){writeFile(this.path,JSON.stringify(t),{encoding:"utf8",mode:432,flag:"w"},t=>e(t))}_getData(t){readFile(this.path,"utf8",(e,r)=>{if(e)"ENOENT"===e.code?t(null,{}):t(e);else{try{r=r.trim().length?JSON.parse(r):{}}catch(e){return void t(e)}t(null,r)}})}}
//# sourceMappingURL=/sm/bd7d6ac296a79d33a2ccba398d235c4b4ad7352a5026cfea2f0d21b71517d78a.map